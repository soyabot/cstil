컴퓨터의 멀티태스킹:
스레드 A를 멈추는 시점에 CPU에서 사용하던 이런 값들을 메모리에 저장해두어야한다 이후에 스레드A를 다시 실행할 때 이 값들을 cpu에 다시 불러와야한다

컨텍스트는 현재 작업하는 문맥을 의미한다. 현재 작업하는 문매깅 변하기 때문에 컨텍스트 스위칭이다
컨텍스트 스위칭 과정에서 이전에 실행 중인 값을 메모리에 잠깐 저장하고, 이후에다시 실행하는 시점에 저장한 값을 cpu에 다시 불러와야한다
결과적으로 컨텍스트 스위칭 과정에는 약간의 비용이 발생한다

-멀티스레드는 대부분 효율적이지만, 컨텍스트 스위칭 과정이 필요하므로 항상 효율적인 것은 아니다
- 스레드 1: 1-5000까지 더함
- 스레드 2: 5001 -10000까지 더함
- 마지막에 스레드 1의 결과와 스레드 2의 결과를 더함

cpu 코어가 2개
- cpu 코어가 2개 있으면 스레드 1, 스레드 2나누에 멀티스레드로 병렬처리하는게 효율적이다.
- 모든 cpu를 사용하므로 연산을 2배빠르게 처리할 수 있다.
cpu 코어가 1개
- 스레드를 2개로 만들어서 연산하면 중간중간 컨텍스트 스위칭 비용이 발생한다
- 운영체제 스케줄링 방식에 따라서 다르겠지만, 스레드 1을 1 -1000정도까지 연산한 상태에서 잠시 멈추고 스레드 2 5001-6001까지 연산하는 식으로 반복할 수 있다. 이때 cpu는 스레드 1을 멈추고 다시 실행할 때까지 어디까지 연산했는지 알아야할고, 그 값을 cpu에 다시 불러와야한다. 결과적으로 이렇게 반복할때 마다 컨텍스트 스위칭 비용이 든다 
- 결과적으로 연산 시간 + 컨텍스트 스위칭 시간이 든다

cpu -4개 스레드 2개
스레드의 숫자가 너무 적으면 모든 cpu를 100% 다 활용할 수 없지만, 스레드가 몇 개없으므로 컨텍스트 스위칭 비용이 줄어든다
cpu -4개 스레드 2개
스레드의 숫자가 너무 많으면 cpu를 100%활용할 수 있지만 컨텍스트 스위칭 비용이 늘어난다
cpu -4개 스레드 -4개
스레드의 숫자를 cpu의 숫자에 맞춘다면 cpu를 100% 활용할 수 도 잇고, 컨텍스트 스위칭 비용도 자주 발생하지 않기 때문에 최적의 상태가 된다 이상적으로 cpu 코어수 +1개 정도는 스레드를 맞추면 특정 스레드가 잠시 대기할 때 남은 스레드를 활용할 수 잇다

cpu바운드 작업 vs i/o바운드 작업 각각의 스레드가 하는 작업은 크게 2가지로 구분할 수 있다.

cpu 바운드 작업
-cpu 연산 능력을 많이 요구
-이러한 작업은 주로계산, 데이터 처리, 알고리즘 실행등 cpu처리 속도가 작업완료시간을 결정

i/o-바운드작업
-디스크, 네트워크, 파일시스템등과 같은 입출력 작업을 많이 요구
-i/o작업이 완료될때 까지 대기 시간이 많이 발생 , cpu는 상대적으로 유휴(대기)상태에 있는 경우가 많다 
쉽게 이야기해서 스레드가 cpu를 사용하지 않고 i/o작업이 완료될때까지 대기한다


실무
cpu -바운드 작업보다는 i/o바운드 작업이 많다
백엔드 개발자의 경우 주로 웹애플리케연 서버를 개발하는데 1-10000까지 더하는 cpu연산이 필요한 작업보다는, 대부분 사용자의 입력을 기다리거나, 데이터베이스를 호출하고 그 겨로가를 기다리는 등 , 기다리는 일이 많다. 쉽게 이야기해서 스레드가 cpu를 많이 사용하지 않는 i/0-바운드 작업이 많다는 뜻이다

-일반적인 자바 웹 애플리케이션 서버의 경우 사용자의 용청을 하나 처리하는데 1개의 스레드가 필요하다.
사용자 4명이 동시에 요청하면, 4개의 스레드가 작동하는 것이다. 그래야 4명의 사용자의 요청을 동시에 처리할 수 있다.

사용자 요청을 하나 처리하는데, 스레드는 cpu 1%사용하고, 대부분 데이터베이스 서버에 어떤 결과를 조회하면서 기다린다. 스레드는 cpu를 거의 사용하지 않고도 대기한다. 바로 i/o바운드 작업이 많다는 것이다.

이경우 cpu코어가 4개가 있다고해서, 스레드 숫자돋 cpu코어에 맞추어 4개로 설정하면 안된다. 동시에 4명의 사용자 요청만 처리할 수 잇다. 이때 cpu는 단순하게 계산해서 4%정도만 사용할 것이다. 결국 사용자는 동시에 4명 밖에 못받지만 cpu는 4%만 사용하며 cpu가 놀고 잇는 사태가 벌어질 수 있다.

사용자 요청 하나를 처리하는데 cpu를 1%만 사용한다면 단순하게 생각해도 100개의 스레드를 만들 수 잇다. 이렇게 하면 동시에 100명의 사용자 요청을 받을 수 있다. 
물론 실무에서는 성능 테스트를 통해서 최적의 스레드 숫자를 찾는 것이 이상적이다.

# summary

-cpu 바운드작업: cpu코어수 +!개
- cpu를 거의 100% 사용하는 작업 스레드를 cpu숫자에 최적화


-i/o바운드 작업 : cpu코어수 보다 많은 스레드 생성, cpu를 최대한 사용할 수 있는 숫자까지 스레드 생성
- cpu를 많이 사용하지 않으므로 성능 테스트를 통해 cpu를 최대한 활용하는 숫자까지 스레드 생성
- 너무 많은 스레드를 생성하면 컨텍스트 스위칭 비용도 함께 증가 - 적절한 성능 테스트 필요
- 단 너무 많은 스레드를 생성하면 컨텍스트 스위칭 비용도 함께 증가 - 적절한 성능 테스트 필요


